---
/**
 * FAQSection.astro — filmstrip (edge-to-edge) using the same pattern as ServicesSection.
 * - Edge-to-edge rows with a left-rail clearance (via --faq-left-rail / --left-rail).
 * - Base row height ~120px; expands to ~320px on hover/focus-within.
 * - Answer content reveals on hover/focus-within.
 * - Timeline uses sharp square nodes to match the site’s hard-edge style.
 */

type TimelineStep = { label: string; note?: string };
type FAQBlock =
  | { type: 'para'; text: string }
  | { type: 'bullets'; items: string[] }
  | { type: 'timeline'; steps: TimelineStep[]; note?: string };

type FAQItem = {
  id: string;
  question: string;
  blurb?: string;
  answer: FAQBlock[];
};

// Adjust this if your social rail width changes.
// Falls back to --left-rail if defined globally; otherwise uses 96px.
const LEFT_RAIL_VAR = 'var(--left-rail, 96px)';

const FAQ: FAQItem[] = [
  {
    id: 'process',
    question: 'What does your design process look like from start to finish?',
    blurb:
      'Discovery → Concepts → Iteration → Delivery, with weekly 1:1s and critique-driven decisions.',
    answer: [
      {
        type: 'timeline',
        steps: [
          { label: 'Discovery', note: 'Goals, audience, constraints' },
          { label: 'Concepts', note: 'Studies, moodboards, direction' },
          { label: 'Iteration', note: 'Critique, polish, validation' },
          { label: 'Delivery', note: 'Sources + exports + guidance' }
        ],
        note:
          'We keep momentum with weekly reviews and clear targets. If scope changes, we re-estimate before proceeding.'
      },
      {
        type: 'bullets',
        items: [
          'Outcomes first → work in small, reviewable increments.',
          'Direct critique welcomed—call out what hits and what misses.',
          'Deliverables are organized, named, and packaged for immediate use.'
        ]
      }
    ]
  },
  {
    id: 'timeline',
    question: 'How long does a typical project take?',
    blurb: 'Smaller items: days. Kits/campaigns: 1–2 weeks. Identity systems: 3–5+ weeks.',
    answer: [
      {
        type: 'para',
        text:
          'Turnaround depends on scope, assets, and approvals. Smaller deliverables ship in days; larger systems take weeks. You’ll get a simple milestone schedule so progress is visible end-to-end.'
      },
      {
        type: 'bullets',
        items: [
          'Thumbnails / single graphics: 24–72 hours',
          'Social / streaming kits: ~1–2 weeks',
          'Branding systems: ~2–5 weeks (depth dictates range)'
        ]
      }
    ]
  },
  {
    id: 'pricing',
    question: 'How do you price projects? What affects the quote?',
    blurb: 'Fixed for clear scope; hourly for exploration. The clearer the spec, the tighter the quote.',
    answer: [
      {
        type: 'para',
        text:
          'Quotes reflect time, complexity, unknowns, and revision expectations. Fixed bids are ideal once scope is clear; discovery-heavy work uses hourly with caps and weekly checkpoints—so you always stay in control.'
      },
      {
        type: 'bullets',
        items: [
          'Well-defined scope → predictable fixed bids',
          'Exploratory/R&D → hourly with caps + weekly checkpoints',
          'Rush, animation, or heavy production increase the estimate'
        ]
      }
    ]
  },
  {
    id: 'revisions',
    question: 'How many rounds of revisions are included?',
    blurb: 'Two rounds are typical; more are fine if they’re scheduled and scoped.',
    answer: [
      {
        type: 'para',
        text:
          'Most packages include two revision rounds per milestone. If you need more changes, we’ll either rebalance scope or add a capped block of hours so you get cost control and a clean schedule.'
      },
      {
        type: 'bullets',
        items: [
          'Critique at each checkpoint keeps revisions efficient',
          'We flag scope creep early—before it derails timelines',
          'You sign off at each stage so there are no surprises'
        ]
      }
    ]
  },
  {
    id: 'deliverables',
    question: 'What file types and deliverables do I receive?',
    blurb: 'Sources and exports, organized, labeled, and ready for use.',
    answer: [
      {
        type: 'para',
        text:
          'You’ll receive the agreed source files and screen/print exports in a tidy structure (e.g., AI/PSD/SVG/PNGs, plus PDFs where needed). A short usage note is included so your team can self-serve quickly.'
      },
      {
        type: 'bullets',
        items: [
          'Source files as applicable (AI/PSD/SVG/FIG/INDD)',
          'Screen-optimized exports (PNG/JPG/WebP/SVG)',
          'Print-ready files (PDF/X) with bleeds and marks'
        ]
      }
    ]
  },
  {
    id: 'ownership',
    question: 'Who owns the work when the project is finished?',
    blurb: 'You receive a broad license to use deliverables for the agreed scope.',
    answer: [
      {
        type: 'para',
        text:
          'Upon final payment, you receive a broad license to use the deliverables in your agreed channels. I retain the right to show the work in my portfolio unless we agree otherwise (e.g., embargo for a timed launch).'
      },
      {
        type: 'bullets',
        items: [
          'Custom brand/IP—license aligns to your distribution',
          'Third-party assets (fonts/stock) keep their own licenses',
          'NDA/embargo available for stealth launches'
        ]
      }
    ]
  },
  {
    id: 'payment',
    question: 'How do payments work?',
    blurb: '50% to begin, balance at delivery; retainers and milestones available.',
    answer: [
      {
        type: 'para',
        text:
          'A 50% start invoice secures the slot and kicks off work. The remainder is billed on delivery or per milestone for longer projects. Retainers are available for ongoing needs and include priority turnaround.'
      },
      {
        type: 'bullets',
        items: [
          'Invoices via Stripe (card/ACH) or your procurement system',
          'Net terms possible after the first project',
          'Retainers include reserved hours and faster response'
        ]
      }
    ]
  },
  {
    id: 'communication',
    question: 'How do we communicate and review work?',
    blurb: 'Weekly 1:1s + async updates. You’ll always know what’s next.',
    answer: [
      {
        type: 'para',
        text:
          'We keep a simple cadence: weekly live review (30–45 minutes) and concise async updates with decisions and next steps. You’ll see progress assets and have a dedicated place to leave feedback.'
      },
      {
        type: 'bullets',
        items: [
          'Weekly 1:1s keep decisions moving',
          'Async updates outline what shipped and what’s next',
          'Shared folder links make files easy to find'
        ]
      }
    ]
  },
  {
    id: 'tools',
    question: 'Which tools do you use?',
    blurb: 'Adobe (PS/AI/ID), Affinity, Figma, and a modern web stack.',
    answer: [
      {
        type: 'para',
        text:
          'I match tools to the job: Adobe for heavy raster/vector/print, Affinity when it’s faster to ship, Figma for systems and collaboration, and Svelte/Astro/Tailwind when building web experiences.'
      },
      {
        type: 'bullets',
        items: [
          'Photoshop, Illustrator, InDesign, Affinity Suite',
          'Figma for UI/UX and component systems',
          'Svelte / Astro / Tailwind for the web work'
        ]
      }
    ]
  }
];
---

<section id="faq" class="section bg-[var(--surface-0,#0a0a0a)]">
  <!-- Header (contained) -->
  <div class="mx-auto max-w-6xl px-4 py-12 sm:py-14 lg:py-16">
    <div class="mb-6 flex items-center justify-between gap-3">
      <h2 class="text-[clamp(1.35rem,2.2vw,1.75rem)] font-extrabold tracking-tight text-white">
        <span
          class="mr-2 inline-block h-3 w-1.5 translate-y-[2px]"
          style="background: var(--color-brand-500,#E2A028);"
        ></span>
        Frequently Asked Questions
      </h2>
    </div>
  </div>

  <!-- Full-bleed (edge-to-edge) list that clears the left social rail -->
  <div class="faq-bleed" style={`--faq-left-rail: ${LEFT_RAIL_VAR};`}>
    {FAQ.map((item) => (
      <article
        id={`faq-${item.id}`}
        class="group relative isolate w-[100vw] overflow-hidden border-b border-white/10 bg-black/30 transition-colors hover:bg-black/40 focus-within:bg-black/40"
      >
        <!-- Row (height expands on hover/focus-within) -->
        <div class="faq-row pointer-events-none relative flex items-center gap-3">
          <!-- Brand tick -->
          <div
            class="mr-2 inline-block h-3 w-1.5"
            style="background: var(--color-brand-500,#E2A028);"
          ></div>

          <!-- Content shifted right to clear social rail -->
          <div class="faq-content min-w-0 flex-1">
            <h3 class="truncate text-[13px] sm:text-[14px] font-extrabold tracking-tight text-white">
              {item.question}
            </h3>

            {item.blurb && (
              <p class="mt-1 line-clamp-1 text-[12px] text-white/75 transition-opacity duration-200 group-hover:opacity-90">
                {item.blurb}
              </p>
            )}

            <!-- Answer (revealed on hover/focus-within) -->
            <div class="faq-answer mt-2">
              {item.answer.map((blk) => (
                <>
                  {blk.type === 'para' && <p class="ans-para">{blk.text}</p>}

                  {blk.type === 'bullets' && (
                    <ul class="ans-list">
                      {blk.items.map((li) => <li>{li}</li>)}
                    </ul>
                  )}

                  {blk.type === 'timeline' && (
                    <div class="ans-timeline">
                      <svg class="timeline-svg" viewBox="0 0 1120 140" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
                        <line x1="90" y1="70" x2="1030" y2="70" stroke="rgba(255,255,255,.22)" stroke-width="2" />
                        {
                          blk.steps.map((s, idx) => {
                            const count = blk.steps.length;
                            const n = Math.max(1, count - 1);
                            const x0 = 90, x1 = 1030, span = x1 - x0;
                            const x = x0 + (idx * (span / n));
                            const isFirst = idx === 0;
                            const isLast  = idx === count - 1;
                            const anchor  = isFirst ? 'start' : (isLast ? 'end' : 'middle');
                            const dx      = isFirst ? 8 : (isLast ? -8 : 0);
                            return (
                              <g>
                                <rect x={x - 6} y={64} width="12" height="12" fill="var(--color-brand-500,#E2A028)" />
                                <text x={x} dx={dx} y="38" text-anchor={anchor} class="tl-label">{s.label}</text>
                                {s.note && <text x={x} dx={dx} y="114" text-anchor={anchor} class="tl-note">{s.note}</text>}
                              </g>
                            );
                          })
                        }
                      </svg>
                      {blk.note && <p class="ans-para mt-2">{blk.note}</p>}
                    </div>
                  )}
                </>
              ))}
            </div>
          </div>

          <!-- Right affordance -->
          <div
            class="pointer-events-none absolute right-[1rem] top-1/2 -translate-y-1/2 text-[12px] font-semibold text-[var(--color-brand-500,#E2A028)] underline underline-offset-4 decoration-[var(--color-brand-500,#E2A028)] opacity-0 translate-x-1 transition duration-200 ease-out group-hover:opacity-100 group-hover:translate-x-0"
          >
            View answer →
          </div>
        </div>

        <!-- Full-row focus target (keeps expanded state for keyboard users) -->
        <button type="button" class="row-focus" aria-label={`Show answer: ${item.question}`} />
      </article>
    ))}
  </div>
</section>

<style>
  /* Full-bleed helper to span viewport edge-to-edge */
  .faq-bleed {
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    width: 100vw;
  }

  /* Filmstrip row: edge-to-edge, with left-rail clearance via padding-left */
  .faq-row {
    padding-left: calc(var(--faq-left-rail, 96px) + 1rem);
    padding-right: 1rem;

    height: 120px;                 /* base height */
    transition: height .25s ease, padding .25s ease;
    display: flex;
    align-items: center;
  }
  /* Expanded height on hover/focus-within */
  .group:hover .faq-row,
  .group:focus-within .faq-row {
    height: 320px;
  }

  /* Content: ensure long lines don’t run under right affordance */
  .faq-content { padding-right: 7.5rem; }

  /* Reveal the answer content smoothly */
  .faq-answer {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition: max-height .28s ease, opacity .22s ease;
  }
  .group:hover .faq-answer,
  .group:focus-within .faq-answer {
    max-height: 360px;  /* pairs well with 320px row height; tweak if needed */
    opacity: 1;
  }

  /* Right affordance animation */
  .group:hover .row-afford,
  .group:focus-within .row-afford { opacity: 1; transform: translateY(-50%) translateX(0); }

  /* Full-row focus target (for keyboard users) */
  .row-focus {
    position: absolute;
    inset: 0;
    background: transparent;
    border: 0;
  }

  /* One-line clamp without plugin */
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1; line-clamp: 1;
    -webkit-box-orient: vertical; overflow: hidden;
  }

  /* Answer typography */
  .ans-para {
    color: rgba(230,230,230,.9);
    font-size: 13.5px;
    line-height: 1.55;
    margin: .4rem 0;
  }
  .ans-list {
    margin: .35rem 0 .1rem 0;
    padding-left: 1.05rem;
    color: rgba(230,230,230,.9);
    font-size: 13.5px;
  }
  .ans-list li { margin: .2rem 0; }

  /* Timeline (sharp squares; no rounded corners) */
  .ans-timeline { width: min(100%, 1060px); margin: .2rem 0; }
  .timeline-svg { width: 100%; height: auto; display: block; overflow: visible; }
  .tl-label { fill: #fff; font-size: 12px; font-weight: 800; }
  .tl-note  { fill: rgba(255,255,255,.78); font-size: 11px; }
</style>
